#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/socket.h>
#include <arpa/inet.h>

int main(int argc, char **argv)
{
	int sockfd;
	struct sockaddr_in server;
	char data[1024];
	char payload[] = "E\x04\x00\x00\x00ABCD";
	// char *payload;

	server.sin_family = AF_INET;
	server.sin_addr.s_addr = inet_addr("127.0.0.1");
	server.sin_port = htons(20002);	

	sockfd = socket(AF_INET, SOCK_STREAM, 0);
	if (connect(sockfd, (struct sockaddr *)&server, sizeof(server)) < 0) {
		perror("Connection failed");
		return 1;
	}
	
	int size = 4;	
	/*snprintf(payload, sizeof(payload), "%s%s%s%s", 
		"E",
		"\x04\x00\x00\x00",
		"ABCD",
		"Q"
	);*/
	//strcat(payload, "E");
	// strcat(payload, (char *)4);
	//strcat(payload, "ABCD");

	// printf("Payload: %s, length: %d\n", payload, strlen(payload));
	
	// return 0;

	// exit;
	// sleep(5);	
	if (recv(sockfd, data, 1024, 0) < 0) {
		perror("Receiving failed!");
		return 1;
	}	
	
	printf("%s\n", data);
	if (send(sockfd, payload, sizeof(payload), 0) < 0) {
		perror("Sending failed!");
		return 1;
	}

	//while (1) {
		if (recv(sockfd, data, 1024, 0) < 0) {
			perror("Receiving failed!");
			return 1;
		}

		recv(sockfd, data, 1024, 0);

		printf("%s\n", data);
	//}
	
	close(sockfd);
	return 0;
}
